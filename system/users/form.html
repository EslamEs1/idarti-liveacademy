<!DOCTYPE html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>إضافة/تعديل مستخدم - IDARTI Live Academy</title>

        <!-- Bootstrap RTL CSS -->
        <link rel="stylesheet" href="../../assets/css/bootstrap.rtl.min.css" />
        <!-- Bootstrap Icons -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
        />
        <!-- Custom System CSS -->
        <link rel="stylesheet" href="../../assets/css/custom_system.css" />
    </head>
    <body>
        <div class="d-flex">
            <!-- Sidebar -->
            <div id="sidebar-container"></div>

            <!-- Main Content -->
            <div class="content-wrapper">
                <!-- Navbar -->
                <div id="navbar-container"></div>

                <!-- Page Content -->
                <div class="container-fluid px-4 py-4">
                    <!-- Page Header -->
                    <div
                        class="d-flex justify-content-between align-items-center mb-4"
                    >
                        <div>
                            <h4 class="mb-1 fw-bold" id="pageTitle">
                                إضافة مستخدم جديد
                            </h4>
                            <p class="text-muted mb-0">
                                أدخل تفاصيل المستخدم الجديد
                            </p>
                        </div>
                        <a
                            href="../../system/users/list.html"
                            class="btn btn-light"
                        >
                            <i class="bi bi-arrow-right me-2"></i>العودة للقائمة
                        </a>
                    </div>

                    <form
                        id="userForm"
                        class="needs-validation"
                        action="../../api/users"
                        method="POST"
                        novalidate
                    >
                        <div class="row g-4">
                            <!-- Left Column - Main Info -->
                            <div class="col-lg-8">
                                <!-- Personal Information Card -->
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h6 class="mb-0 fw-semibold">
                                            <i
                                                class="bi bi-person-badge me-2"
                                            ></i
                                            >المعلومات الشخصية
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <!-- First Name -->
                                            <div class="col-md-6">
                                                <label
                                                    for="firstName"
                                                    class="form-label"
                                                    >الاسم الأول
                                                    <span class="text-danger"
                                                        >*</span
                                                    ></label
                                                >
                                                <input
                                                    type="text"
                                                    class="form-control"
                                                    id="firstName"
                                                    required
                                                />
                                                <div class="invalid-feedback">
                                                    يرجى إدخال الاسم الأول
                                                </div>
                                            </div>

                                            <!-- Last Name -->
                                            <div class="col-md-6">
                                                <label
                                                    for="lastName"
                                                    class="form-label"
                                                    >اسم العائلة
                                                    <span class="text-danger"
                                                        >*</span
                                                    ></label
                                                >
                                                <input
                                                    type="text"
                                                    class="form-control"
                                                    id="lastName"
                                                    required
                                                />
                                                <div class="invalid-feedback">
                                                    يرجى إدخال اسم العائلة
                                                </div>
                                            </div>

                                            <!-- Email -->
                                            <div class="col-md-6">
                                                <label
                                                    for="email"
                                                    class="form-label"
                                                    >البريد الإلكتروني
                                                    <span class="text-danger"
                                                        >*</span
                                                    ></label
                                                >
                                                <div class="input-group">
                                                    <span
                                                        class="input-group-text"
                                                    >
                                                        <i
                                                            class="bi bi-envelope"
                                                        ></i>
                                                    </span>
                                                    <input
                                                        type="email"
                                                        class="form-control"
                                                        id="email"
                                                        required
                                                    />
                                                </div>
                                                <div class="invalid-feedback">
                                                    يرجى إدخال بريد إلكتروني
                                                    صحيح
                                                </div>
                                            </div>

                                            <!-- Phone -->
                                            <div class="col-md-6">
                                                <label
                                                    for="phone"
                                                    class="form-label"
                                                    >رقم الهاتف
                                                    <span class="text-danger"
                                                        >*</span
                                                    ></label
                                                >
                                                <div class="input-group">
                                                    <span
                                                        class="input-group-text"
                                                    >
                                                        <i
                                                            class="bi bi-phone"
                                                        ></i>
                                                    </span>
                                                    <input
                                                        type="tel"
                                                        class="form-control"
                                                        id="phone"
                                                        placeholder="+966 5X XXX XXXX"
                                                        required
                                                    />
                                                </div>
                                                <div class="invalid-feedback">
                                                    يرجى إدخال رقم هاتف صحيح
                                                </div>
                                            </div>

                                            <!-- Date of Birth -->
                                            <div class="col-md-6">
                                                <label
                                                    for="birthDate"
                                                    class="form-label"
                                                    >تاريخ الميلاد</label
                                                >
                                                <div class="input-group">
                                                    <span
                                                        class="input-group-text"
                                                    >
                                                        <i
                                                            class="bi bi-calendar"
                                                        ></i>
                                                    </span>
                                                    <input
                                                        type="date"
                                                        class="form-control"
                                                        id="birthDate"
                                                    />
                                                </div>
                                            </div>

                                            <!-- Gender -->
                                            <div class="col-md-6">
                                                <label
                                                    for="gender"
                                                    class="form-label"
                                                    >الجنس</label
                                                >
                                                <select
                                                    class="form-select"
                                                    id="gender"
                                                >
                                                    <option value="">
                                                        اختر...
                                                    </option>
                                                    <option value="male">
                                                        ذكر
                                                    </option>
                                                    <option value="female">
                                                        أنثى
                                                    </option>
                                                </select>
                                            </div>

                                            <!-- National ID -->
                                            <div class="col-md-6">
                                                <label
                                                    for="nationalId"
                                                    class="form-label"
                                                    >رقم الهوية الوطنية</label
                                                >
                                                <input
                                                    type="text"
                                                    class="form-control"
                                                    id="nationalId"
                                                />
                                            </div>

                                            <!-- Nationality -->
                                            <div class="col-md-6">
                                                <label
                                                    for="nationality"
                                                    class="form-label"
                                                    >الجنسية</label
                                                >
                                                <select
                                                    class="form-select"
                                                    id="nationality"
                                                >
                                                    <option value="">
                                                        اختر...
                                                    </option>
                                                    <option value="SA" selected>
                                                        السعودية
                                                    </option>
                                                    <option value="EG">
                                                        مصر
                                                    </option>
                                                    <option value="JO">
                                                        الأردن
                                                    </option>
                                                    <option value="AE">
                                                        الإمارات
                                                    </option>
                                                    <option value="KW">
                                                        الكويت
                                                    </option>
                                                    <option value="QA">
                                                        قطر
                                                    </option>
                                                    <option value="BH">
                                                        البحرين
                                                    </option>
                                                    <option value="OM">
                                                        عمان
                                                    </option>
                                                    <option value="IQ">
                                                        العراق
                                                    </option>
                                                    <option value="SY">
                                                        سوريا
                                                    </option>
                                                    <option value="LB">
                                                        لبنان
                                                    </option>
                                                    <option value="PS">
                                                        فلسطين
                                                    </option>
                                                    <option value="YE">
                                                        اليمن
                                                    </option>
                                                    <option value="other">
                                                        أخرى
                                                    </option>
                                                </select>
                                            </div>

                                            <!-- Address -->
                                            <div class="col-12">
                                                <label
                                                    for="address"
                                                    class="form-label"
                                                    >العنوان</label
                                                >
                                                <textarea
                                                    class="form-control"
                                                    id="address"
                                                    rows="2"
                                                ></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Account Information Card -->
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h6 class="mb-0 fw-semibold">
                                            <i
                                                class="bi bi-shield-lock me-2"
                                            ></i
                                            >معلومات الحساب
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <!-- Username -->
                                            <div class="col-md-6">
                                                <label
                                                    for="username"
                                                    class="form-label"
                                                    >اسم المستخدم
                                                    <span class="text-danger"
                                                        >*</span
                                                    ></label
                                                >
                                                <div class="input-group">
                                                    <span
                                                        class="input-group-text"
                                                    >
                                                        <i class="bi bi-at"></i>
                                                    </span>
                                                    <input
                                                        type="text"
                                                        class="form-control"
                                                        id="username"
                                                        required
                                                    />
                                                </div>
                                                <div class="invalid-feedback">
                                                    يرجى إدخال اسم المستخدم
                                                </div>
                                            </div>

                                            <!-- Role -->
                                            <div class="col-md-6">
                                                <label
                                                    for="role"
                                                    class="form-label"
                                                    >الدور
                                                    <span class="text-danger"
                                                        >*</span
                                                    ></label
                                                >
                                                <select
                                                    class="form-select"
                                                    id="role"
                                                    required
                                                >
                                                    <option value="">
                                                        اختر الدور...
                                                    </option>
                                                    <option value="student">
                                                        طالب
                                                    </option>
                                                    <option value="teacher">
                                                        معلم
                                                    </option>
                                                    <option value="supervisor">
                                                        مشرف
                                                    </option>
                                                    <option value="admin">
                                                        مدير النظام
                                                    </option>
                                                </select>
                                                <div class="invalid-feedback">
                                                    يرجى اختيار دور المستخدم
                                                </div>
                                            </div>

                                            <!-- Password -->
                                            <div class="col-md-6">
                                                <label
                                                    for="password"
                                                    class="form-label"
                                                >
                                                    كلمة المرور
                                                    <span
                                                        class="text-danger"
                                                        id="passwordRequired"
                                                        >*</span
                                                    >
                                                </label>
                                                <div class="input-group">
                                                    <span
                                                        class="input-group-text"
                                                    >
                                                        <i
                                                            class="bi bi-lock"
                                                        ></i>
                                                    </span>
                                                    <input
                                                        type="password"
                                                        class="form-control"
                                                        id="password"
                                                    />
                                                    <button
                                                        class="btn btn-outline-secondary"
                                                        type="button"
                                                        id="togglePassword"
                                                    >
                                                        <i
                                                            class="bi bi-eye"
                                                        ></i>
                                                    </button>
                                                </div>
                                                <small class="text-muted"
                                                    >يجب أن تحتوي على 8 أحرف على
                                                    الأقل</small
                                                >
                                                <div class="invalid-feedback">
                                                    يرجى إدخال كلمة مرور قوية
                                                </div>
                                            </div>

                                            <!-- Confirm Password -->
                                            <div class="col-md-6">
                                                <label
                                                    for="confirmPassword"
                                                    class="form-label"
                                                >
                                                    تأكيد كلمة المرور
                                                    <span
                                                        class="text-danger"
                                                        id="confirmPasswordRequired"
                                                        >*</span
                                                    >
                                                </label>
                                                <div class="input-group">
                                                    <span
                                                        class="input-group-text"
                                                    >
                                                        <i
                                                            class="bi bi-lock-fill"
                                                        ></i>
                                                    </span>
                                                    <input
                                                        type="password"
                                                        class="form-control"
                                                        id="confirmPassword"
                                                    />
                                                    <button
                                                        class="btn btn-outline-secondary"
                                                        type="button"
                                                        id="toggleConfirmPassword"
                                                    >
                                                        <i
                                                            class="bi bi-eye"
                                                        ></i>
                                                    </button>
                                                </div>
                                                <div class="invalid-feedback">
                                                    كلمة المرور غير متطابقة
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Additional Notes Card -->
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0 fw-semibold">
                                            <i class="bi bi-chat-text me-2"></i
                                            >ملاحظات إضافية
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <label for="notes" class="form-label"
                                            >ملاحظات</label
                                        >
                                        <textarea
                                            class="form-control"
                                            id="notes"
                                            rows="4"
                                            placeholder="أضف أي ملاحظات إضافية هنا..."
                                        ></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column - Status & Settings -->
                            <div class="col-lg-4">
                                <!-- Profile Picture Card -->
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h6 class="mb-0 fw-semibold">
                                            <i class="bi bi-image me-2"></i
                                            >الصورة الشخصية
                                        </h6>
                                    </div>
                                    <div class="card-body text-center">
                                        <div
                                            class="avatar-xl mx-auto mb-3 d-flex align-items-center justify-content-center rounded-circle"
                                            class="size-120 avatar-gradient-primary"
                                        >
                                            <i
                                                class="bi bi-person-fill text-white"
                                                class="fs-4rem"
                                            ></i>
                                        </div>
                                        <button
                                            type="button"
                                            class="btn btn-sm btn-outline-primary w-100 mb-2"
                                        >
                                            <i class="bi bi-upload me-2"></i>رفع
                                            صورة
                                        </button>
                                        <small class="text-muted d-block"
                                            >JPG، PNG أو GIF. الحد الأقصى
                                            2MB</small
                                        >
                                    </div>
                                </div>

                                <!-- Status Card -->
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h6 class="mb-0 fw-semibold">
                                            <i class="bi bi-toggle-on me-2"></i
                                            >الحالة والإعدادات
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <!-- Account Status -->
                                        <div class="mb-3">
                                            <label
                                                for="status"
                                                class="form-label"
                                                >حالة الحساب</label
                                            >
                                            <select
                                                class="form-select"
                                                id="status"
                                            >
                                                <option value="active" selected>
                                                    نشط
                                                </option>
                                                <option value="inactive">
                                                    غير نشط
                                                </option>
                                                <option value="suspended">
                                                    موقوف
                                                </option>
                                            </select>
                                        </div>

                                        <!-- Email Verified -->
                                        <div
                                            class="form-check form-switch mb-3"
                                        >
                                            <input
                                                class="form-check-input"
                                                type="checkbox"
                                                id="emailVerified"
                                            />
                                            <label
                                                class="form-check-label"
                                                for="emailVerified"
                                            >
                                                البريد الإلكتروني مُفعّل
                                            </label>
                                        </div>

                                        <!-- Phone Verified -->
                                        <div
                                            class="form-check form-switch mb-3"
                                        >
                                            <input
                                                class="form-check-input"
                                                type="checkbox"
                                                id="phoneVerified"
                                            />
                                            <label
                                                class="form-check-label"
                                                for="phoneVerified"
                                            >
                                                رقم الهاتف مُفعّل
                                            </label>
                                        </div>

                                        <!-- Send Welcome Email -->
                                        <div
                                            class="form-check form-switch mb-3"
                                        >
                                            <input
                                                class="form-check-input"
                                                type="checkbox"
                                                id="sendWelcomeEmail"
                                                checked
                                            />
                                            <label
                                                class="form-check-label"
                                                for="sendWelcomeEmail"
                                            >
                                                إرسال بريد ترحيبي
                                            </label>
                                        </div>

                                        <!-- Two Factor Auth -->
                                        <div class="form-check form-switch">
                                            <input
                                                class="form-check-input"
                                                type="checkbox"
                                                id="twoFactorAuth"
                                            />
                                            <label
                                                class="form-check-label"
                                                for="twoFactorAuth"
                                            >
                                                التحقق بخطوتين
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Permissions Card (for non-admin roles) -->
                                <div
                                    class="card mb-4"
                                    id="permissionsCard"
                                    class="d-none"
                                >
                                    <div class="card-header">
                                        <h6 class="mb-0 fw-semibold">
                                            <i class="bi bi-key me-2"></i
                                            >الصلاحيات الإضافية
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <small class="text-muted d-block mb-3"
                                            >منح صلاحيات إضافية للمستخدم</small
                                        >

                                        <div class="form-check mb-2">
                                            <input
                                                class="form-check-input"
                                                type="checkbox"
                                                id="canManageCourses"
                                            />
                                            <label
                                                class="form-check-label"
                                                for="canManageCourses"
                                            >
                                                إدارة الدورات
                                            </label>
                                        </div>

                                        <div class="form-check mb-2">
                                            <input
                                                class="form-check-input"
                                                type="checkbox"
                                                id="canManageUsers"
                                            />
                                            <label
                                                class="form-check-label"
                                                for="canManageUsers"
                                            >
                                                إدارة المستخدمين
                                            </label>
                                        </div>

                                        <div class="form-check mb-2">
                                            <input
                                                class="form-check-input"
                                                type="checkbox"
                                                id="canViewReports"
                                            />
                                            <label
                                                class="form-check-label"
                                                for="canViewReports"
                                            >
                                                عرض التقارير
                                            </label>
                                        </div>

                                        <div class="form-check">
                                            <input
                                                class="form-check-input"
                                                type="checkbox"
                                                id="canManagePayments"
                                            />
                                            <label
                                                class="form-check-label"
                                                for="canManagePayments"
                                            >
                                                إدارة المدفوعات
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Buttons Card -->
                                <div class="card">
                                    <div class="card-body">
                                        <button
                                            type="submit"
                                            class="btn btn-primary w-100 mb-2"
                                        >
                                            <i
                                                class="bi bi-check-circle me-2"
                                            ></i
                                            >حفظ المستخدم
                                        </button>
                                        <a
                                            href="/system/users/list.html"
                                            class="btn btn-light w-100"
                                        >
                                            <i class="bi bi-x-circle me-2"></i
                                            >إلغاء
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Footer -->
                <footer class="mt-auto py-3 text-center text-muted small">
                    <p class="mb-0">
                        &copy; 2025 IDARTI Live Academy. جميع الحقوق محفوظة.
                    </p>
                </footer>
            </div>
        </div>

        <!-- Bootstrap JS -->
        <script src="../../assets/js/popper.min.js"></script>
        <script src="../../assets/js/bootstrap.min.js"></script>
        <script src="../../assets/js/custom.js"></script>

        <!-- Load Partials & Form Logic -->
        <script>
            // Dynamically load sidebar and navbar
            fetch("../partials/sidebar_admin.html")
                .then((response) => response.text())
                .then((data) => {
                    document.getElementById("sidebar-container").innerHTML =
                        data;
                    // Set active menu item
                    document
                        .querySelector(
                            '.sidebar-menu-link[href="/system/users/list.html"]'
                        )
                        ?.closest(".sidebar-menu-item")
                        ?.classList.add("active");
                });

            fetch("../partials/navbar.html")
                .then((response) => response.text())
                .then((data) => {
                    document.getElementById("navbar-container").innerHTML =
                        data;
                    // Update page title based on mode (create/edit)
                    const urlParams = new URLSearchParams(
                        window.location.search
                    );
                    const userId = urlParams.get("id");
                    const isEditMode = !!userId;

                    const pageTitle = isEditMode
                        ? "تعديل مستخدم"
                        : "إضافة مستخدم جديد";
                    document.getElementById("currentPageTitle").textContent =
                        pageTitle;
                    document.getElementById("currentBreadcrumb").textContent =
                        pageTitle;
                    document.getElementById("pageTitle").textContent =
                        pageTitle;

                    // If edit mode, populate form with dummy data
                    if (isEditMode) {
                        populateFormForEdit();
                    }
                });

            // Toggle password visibility
            document
                .getElementById("togglePassword")
                ?.addEventListener("click", function () {
                    const passwordInput = document.getElementById("password");
                    const icon = this.querySelector("i");

                    if (passwordInput.type === "password") {
                        passwordInput.type = "text";
                        icon.classList.remove("bi-eye");
                        icon.classList.add("bi-eye-slash");
                    } else {
                        passwordInput.type = "password";
                        icon.classList.remove("bi-eye-slash");
                        icon.classList.add("bi-eye");
                    }
                });

            document
                .getElementById("toggleConfirmPassword")
                ?.addEventListener("click", function () {
                    const passwordInput =
                        document.getElementById("confirmPassword");
                    const icon = this.querySelector("i");

                    if (passwordInput.type === "password") {
                        passwordInput.type = "text";
                        icon.classList.remove("bi-eye");
                        icon.classList.add("bi-eye-slash");
                    } else {
                        passwordInput.type = "password";
                        icon.classList.remove("bi-eye-slash");
                        icon.classList.add("bi-eye");
                    }
                });

            // Role change handler
            document
                .getElementById("role")
                ?.addEventListener("change", function () {
                    const permissionsCard =
                        document.getElementById("permissionsCard");
                    if (this.value && this.value !== "admin") {
                        permissionsCard.style.display = "block";
                    } else {
                        permissionsCard.style.display = "none";
                    }
                });

            // Form validation
            const form = document.getElementById("userForm");
            form?.addEventListener(
                "submit",
                function (event) {
                    event.preventDefault();
                    event.stopPropagation();

                    // Check if passwords match
                    const password = document.getElementById("password").value;
                    const confirmPassword =
                        document.getElementById("confirmPassword").value;

                    if (password !== confirmPassword) {
                        document
                            .getElementById("confirmPassword")
                            .setCustomValidity("كلمة المرور غير متطابقة");
                    } else {
                        document
                            .getElementById("confirmPassword")
                            .setCustomValidity("");
                    }

                    if (form.checkValidity()) {
                        // Simulate form submission
                        alert("تم حفظ المستخدم بنجاح!");
                        window.location.href = "/system/users/list.html";
                    } else {
                        form.classList.add("was-validated");
                    }
                },
                false
            );

            // Populate form for edit mode (dummy data)
            function populateFormForEdit() {
                document.getElementById("firstName").value = "أحمد";
                document.getElementById("lastName").value = "محمد";
                document.getElementById("email").value =
                    "ahmed.mohammed@example.com";
                document.getElementById("phone").value = "+966 50 123 4567";
                document.getElementById("birthDate").value = "1990-05-15";
                document.getElementById("gender").value = "male";
                document.getElementById("nationalId").value = "1234567890";
                document.getElementById("nationality").value = "SA";
                document.getElementById("address").value =
                    "الرياض، المملكة العربية السعودية";
                document.getElementById("username").value = "ahmed.mohammed";
                document.getElementById("role").value = "admin";
                document.getElementById("status").value = "active";
                document.getElementById("emailVerified").checked = true;
                document.getElementById("phoneVerified").checked = true;
                document.getElementById("notes").value = "مستخدم موثوق ونشط";

                // Make password optional in edit mode
                document.getElementById("password").removeAttribute("required");
                document
                    .getElementById("confirmPassword")
                    .removeAttribute("required");
                document.getElementById("passwordRequired").textContent =
                    "(اختياري)";
                document.getElementById("confirmPasswordRequired").textContent =
                    "(اختياري)";
            }
        </script>
    </body>
</html>
